---
// Header component with navigation
import { Image } from 'astro:assets';
---

<header class="sticky top-0 z-50 bg-white shadow-md">
  <nav class="container-custom py-4 flex items-center justify-between">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-2 group">
      <div class="flex items-center justify-center transform group-hover:scale-110 transition-transform duration-300">
        <Image src="/logo.png" alt="APA Maritime Logo" class="w-auto h-15 object-contain" width={150} height={60} loading="eager" />
      </div>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-8">
      <a href="/" class="text-gray-700 font-medium relative group">
        Home
        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></span>
      </a>
      <a href="/about" class="text-gray-700 font-medium relative group">
        About
        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></span>
      </a>

      <!-- Services Dropdown -->
      <div class="relative group">
        <button class="text-gray-700 font-medium flex items-center gap-1 relative" aria-label="Services menu" aria-haspopup="true" aria-expanded="false">
          Services
          <svg class="w-5 h-5 transform group-hover:rotate-180 transition-transform duration-300" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M7 10l5 5 5-5z"></path>
          </svg>
          <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></span>
        </button>
        <div class="absolute left-0 mt-3 w-48 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top group-hover:scale-y-100 scale-y-95" role="menu">
          <a href="/services/chartering" class="block px-4 py-3 text-gray-700 hover:bg-primary hover:text-white transition-colors duration-300 first:rounded-t-lg" role="menuitem" aria-label="Ship Chartering Services">Ship Chartering</a>
          <a href="/services/broking" class="block px-4 py-3 text-gray-700 hover:bg-primary hover:text-white transition-colors duration-300" role="menuitem" aria-label="Ship Broking Services">Ship Broking</a>
          <a href="/services/consultancy" class="block px-4 py-3 text-gray-700 hover:bg-primary hover:text-white transition-colors duration-300 last:rounded-b-lg" role="menuitem" aria-label="Marine Consultancy Services">Marine Services</a>
        </div>
      </div>

      <a href="/team" class="text-gray-700 font-medium relative group">
        Our Team
        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary transition-all duration-300 group-hover:w-full"></span>
      </a>
      <!-- <a href="/blog" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium">Blog</a> -->
      <a href="/contact" class="btn-primary">Contact Us</a>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" class="md:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors duration-300">
      <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </nav>

  <!-- Mobile Navigation -->
  <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
    <div class="container-custom py-4 flex flex-col gap-4">
      <a href="/" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium py-2">Home</a>
      <a href="/about" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium py-2">About</a>
      <a href="/services/chartering" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium py-2 pl-4 border-l-2 border-primary">Ship Chartering</a>
      <a href="/services/broking" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium py-2 pl-4 border-l-2 border-primary">Ship Broking</a>
      <a href="/services/consultancy" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium py-2 pl-4 border-l-2 border-primary">Marine Services</a>
      <a href="/team" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium py-2">Our Team</a>
      <a href="/blog" class="text-gray-700 hover:text-primary transition-colors duration-300 font-medium py-2">Blog</a>
      <a href="/contact" class="btn-primary text-white w-full text-center">Contact Us</a>
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });

  const mobileLinks = mobileMenu?.querySelectorAll('a');
  mobileLinks?.forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.add('hidden');
    });
  });

  // Active page indicator
  function setActiveLink() {
    const currentPath = window.location.pathname;

    // Desktop navigation links (exclude btn-primary)
    const desktopLinks = document.querySelectorAll('.hidden.md\\:flex a[href]:not(.btn-primary)');
    desktopLinks.forEach(link => {
      const href = link.getAttribute('href');
      const isActive = currentPath === href || (href === '/' && currentPath === '/');

      if (isActive) {
        link.classList.add('text-primary');
        link.classList.remove('text-gray-700');
        // Make underline visible for active link
        const underline = link.querySelector('span');
        if (underline) {
          underline.classList.add('w-full');
        }
      } else {
        link.classList.add('text-gray-700');
        link.classList.remove('text-primary');
      }
    });

    // Mobile navigation links (exclude btn-primary)
    const mobileLinks = document.querySelectorAll('#mobile-menu a[href]:not(.btn-primary)');
    mobileLinks.forEach(link => {
      const href = link.getAttribute('href');
      const isActive = currentPath === href || (href === '/' && currentPath === '/');

      if (isActive) {
        link.classList.add('text-primary', 'font-bold');
        link.classList.remove('text-gray-700');
      } else {
        link.classList.add('text-gray-700');
        link.classList.remove('text-primary', 'font-bold');
      }
    });
  }

  // Set active link on page load
  setActiveLink();

  // Update active link on navigation
  window.addEventListener('popstate', setActiveLink);
</script>
